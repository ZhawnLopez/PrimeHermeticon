<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Shop | HermetiCart</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/styles.css">

    <style>
    body { background:#0d0f14; }
    h1,h2,h3,h4 { font-family:'Cormorant Garamond',serif; }

    .page-header {
        padding: 4rem 2rem 2rem;
        text-align: center;
        border-bottom: 1px solid rgba(201,168,76,0.1);
        margin-bottom: 3rem;
    }

    .page-eyebrow {
        font-size: 0.7rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: #c9a84c;
        font-family: 'DM Sans', sans-serif;
        margin-bottom: 0.5rem;
    }

    .page-title {
        font-family: 'Cormorant Garamond', serif;
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 700;
        color: #f0ead6;
        margin-bottom: 0.75rem;
    }

    .page-subtitle {
        font-size: 0.85rem;
        color: #8a8fa8;
        letter-spacing: 0.05em;
    }

    /* Shop Grid */
    #shopGrid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.75rem;
    }

    .shop-card {
        background: #181c26;
        border: 1px solid rgba(201,168,76,0.1);
        border-radius: 16px;
        padding: 1.75rem;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
        transition: transform 0.35s ease, box-shadow 0.35s ease, border-color 0.35s ease;
    }

    .shop-card::after {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(201,168,76,0.5), transparent);
        opacity: 0;
        transition: opacity 0.3s;
    }

    .shop-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 24px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(201,168,76,0.2);
        border-color: rgba(201,168,76,0.25);
    }

    .shop-card:hover::after { opacity: 1; }

    .shop-card-img {
        background: #0d0f14;
        border-radius: 10px;
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.25rem;
        overflow: hidden;
    }

    .shop-card-img img {
        max-height: 160px;
        object-fit: contain;
        transition: transform 0.4s ease;
        filter: drop-shadow(0 6px 14px rgba(0,0,0,0.5));
    }

    .shop-card:hover .shop-card-img img { transform: scale(1.06); }

    .shop-card-name {
        font-family: 'Cormorant Garamond', serif;
        font-size: 1.1rem;
        font-weight: 600;
        color: #f0ead6;
        margin-bottom: 0.4rem;
        line-height: 1.3;
    }

    .shop-card-desc {
        font-size: 0.82rem;
        color: #8a8fa8;
        line-height: 1.6;
        flex: 1;
        margin-bottom: 1rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .shop-card-price {
        font-family: 'DM Sans', sans-serif;
        color: #c9a84c;
        font-size: 1.05rem;
        font-weight: 500;
    }

    .shop-card-stock-ok  { font-size: 0.7rem; color: #5a9e7a; letter-spacing:0.06em; text-transform:uppercase; }
    .shop-card-stock-out { font-size: 0.7rem; color: #8a8fa8; letter-spacing:0.06em; text-transform:uppercase; }

    /* Cart Drawer */
    #cartDrawer {
        background: #13161e;
        border-left: 1px solid rgba(201,168,76,0.15);
    }

    .shop-add-btn:hover:not(:disabled) {
        background: linear-gradient(135deg, #e8c97a, #c9a84c) !important;
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(201,168,76,0.4) !important;
    }
    </style>
</head>
<body>

    <div id="navbar"></div>

    <main style="max-width:1200px; margin:0 auto; padding:0 2rem 5rem;">

        <div class="page-header">
            <p class="page-eyebrow">Browse Collection</p>
            <h1 class="page-title">The Shop</h1>
            <p class="page-subtitle">The Catalogue for the HermetiCart Experience</p>
        </div>

        <div id="shopGrid"></div>
    </main>

    <div id="cartOverlay" class="fixed inset-0 z-40" style="display:none; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px);"></div>

    <div id="cartDrawer" class="fixed right-0 top-0 h-full z-50 flex flex-col" style="width:380px; max-width:100%; transform:translateX(100%); transition:transform 0.3s ease;">
        <div style="padding:1.75rem; border-bottom:1px solid rgba(201,168,76,0.15); display:flex; justify-content:space-between; align-items:center;">
            <h3 style="font-family:'Cormorant Garamond',serif; font-size:1.6rem; color:#f0ead6;">Your Cart</h3>
            <button onclick="toggleCart()" style="background:none; border:none; color:#8a8fa8; font-size:1.4rem; cursor:pointer;">✕</button>
        </div>

        <div id="drawerItems" style="flex:1; overflow-y:auto; padding:1.5rem; display:flex; flex-direction:column; gap:1rem;"></div>

        <div style="padding:1.5rem; border-top:1px solid rgba(201,168,76,0.15);">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.25rem;">
                <span style="font-size:0.75rem; letter-spacing:0.1em; text-transform:uppercase; color:#8a8fa8; font-family:'DM Sans',sans-serif;">Total</span>
                <span id="cartTotal" style="font-size:1.3rem; font-family:'Cormorant Garamond',serif; font-weight:600; color:#c9a84c;">₱0.00</span>
            </div>
            <button id="checkoutBtn" class="btn-primary" style="width:100%; padding:0.9rem; font-size:0.8rem;">Proceed to Checkout</button>
            <button onclick="removeAllItems()" style="width:100%; margin-top:0.75rem; background:none; border:1px solid rgba(192,69,74,0.3); color:#c0454a; font-size:0.75rem; letter-spacing:0.08em; text-transform:uppercase; padding:0.6rem; border-radius:8px; cursor:pointer; font-family:'DM Sans',sans-serif; transition:all 0.2s;" onmouseover="this.style.background='rgba(192,69,74,0.1)'" onmouseout="this.style.background='none'">Clear Cart</button>
        </div>
    </div>

    <script src="../assets/js/navbar.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/carousel.js"></script>

    <script>
    async function renderShopGrid() {
        let prods = window.products;
        if (!Array.isArray(prods) || prods.length === 0) {
            try {
                const res = await fetch("../backend/get_products.php");
                prods = await res.json();
                window.products = prods;
            } catch (err) { prods = []; }
        }

        const grid = document.getElementById("shopGrid");
        grid.innerHTML = "";

        if (!prods || prods.length === 0) {
            grid.innerHTML = `<p style="color:#8a8fa8; text-align:center; grid-column:1/-1; padding:3rem;">No products available.</p>`;
            return;
        }

        prods.forEach(p => {
            const inStock = p.stock_quantity && Number(p.stock_quantity) > 0;
            const card = document.createElement('article');
            card.className = 'shop-card';
            card.innerHTML = `
                <div class="shop-card-img">
                    <img src="../${p.image_url}" alt="${p.name}" onerror="this.style.opacity=0.4; this.src='../assets/images/placeholder.png'">
                </div>
                <h3 class="shop-card-name">${p.name}</h3>
                <p class="shop-card-desc">${p.description || ''}</p>
                <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-top:auto;">
                    <div>
                        <div class="shop-card-price">₱${parseFloat(p.price).toLocaleString()}</div>
                        <div class="${inStock ? 'shop-card-stock-ok' : 'shop-card-stock-out'}" style="margin-top:4px;">
                            ${inStock ? `In Stock (${p.stock_quantity})` : 'Out of Stock'}
                        </div>
                    </div>
                    <button
                        ${inStock ? `onclick="addToCart(${p.product_id})"` : 'disabled'}
                        class="shop-add-btn"
                        style="${inStock 
                            ? 'background:linear-gradient(135deg,#c9a84c,#a88030); color:#0d0f14; cursor:pointer; box-shadow:0 4px 16px rgba(201,168,76,0.25);' 
                            : 'background:#1e2230; color:#3a3f52; cursor:not-allowed; border:1px solid rgba(201,168,76,0.1);'
                        } font-family:DM Sans,sans-serif; font-weight:500; font-size:0.76rem; letter-spacing:0.1em; text-transform:uppercase; padding:0.6rem 1.2rem; border-radius:8px; border:none; transition:all 0.25s ease; white-space:nowrap; flex-shrink:0;">
                        ${inStock ? 'Add to Cart' : 'Unavailable'}
                    </button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    document.addEventListener("DOMContentLoaded", async () => {
        await new Promise(r => setTimeout(r, 60));
        renderShopGrid();
    });
    </script>
</body>
</html>